{% extends "base.html" %} {% block title %}Leave Review - SkillSwap{% endblock
%} {% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow">
        <div class="card-header bg-warning text-dark">
          <h4 class="mb-0 fw-bold">Leave a Review</h4>
        </div>
        <div class="card-body p-4">
          <form id="review-form">
            <div class="mb-4 text-center">
              <label class="form-label d-block">Rating</label>
              <div class="rating-stars">
                <input
                  type="radio"
                  class="btn-check"
                  name="rating"
                  id="rating5"
                  value="5"
                  autocomplete="off"
                />
                <label class="btn btn-outline-warning" for="rating5"
                  >5 <i class="bi bi-star-fill"></i
                ></label>

                <input
                  type="radio"
                  class="btn-check"
                  name="rating"
                  id="rating4"
                  value="4"
                  autocomplete="off"
                />
                <label class="btn btn-outline-warning" for="rating4"
                  >4 <i class="bi bi-star-fill"></i
                ></label>

                <input
                  type="radio"
                  class="btn-check"
                  name="rating"
                  id="rating3"
                  value="3"
                  autocomplete="off"
                />
                <label class="btn btn-outline-warning" for="rating3"
                  >3 <i class="bi bi-star-fill"></i
                ></label>

                <input
                  type="radio"
                  class="btn-check"
                  name="rating"
                  id="rating2"
                  value="2"
                  autocomplete="off"
                />
                <label class="btn btn-outline-warning" for="rating2"
                  >2 <i class="bi bi-star-fill"></i
                ></label>

                <input
                  type="radio"
                  class="btn-check"
                  name="rating"
                  id="rating1"
                  value="1"
                  autocomplete="off"
                />
                <label class="btn btn-outline-warning" for="rating1"
                  >1 <i class="bi bi-star-fill"></i
                ></label>
              </div>
            </div>

            <div class="mb-3">
              <label for="comment" class="form-label">Comment</label>
              <textarea
                class="form-control"
                id="comment"
                rows="4"
                placeholder="How was your experience%s"
              ></textarea>
            </div>

            <div class="d-grid">
              <button type="submit" class="btn btn-primary btn-lg">
                Submit Review
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_scripts %}
<script>
  const API_URL = "https://swkillswap2-1.onrender.com/api";
  const token = localStorage.getItem("token");

  // Get request_id from URL
  const urlParams = new URLSearchParams(window.location.search);
  const requestId = urlParams.get("request_id");

  if (!token || !requestId) {
    window.location.href = "/dashboard";
  }

  document
    .getElementById("review-form")
    .addEventListener("submit", async function (e) {
      e.preventDefault();

      const ratingEl = document.querySelector('input[name="rating"]:checked');
      if (!ratingEl) {
        alert("Please select a rating");
        return;
      }

      const rating = ratingEl.value;
      const comment = document.getElementById("comment").value;

      try {
        const response = await fetch(`${API_URL}/reviews/`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify({
            request_id: parseInt(requestId),
            rating: parseInt(rating),
            comment: comment,
          }),
        });

        if (response.ok) {
          alert("Review submitted successfully!");
          window.location.href = "/requests";
        } else {
          const data = await response.json();
          alert(data.error || "Failed to submit review");
        }
      } catch (error) {
        console.error("Error submitting review:", error);
        alert("Network error");
      }
    });
</script>
{% endblock %}
